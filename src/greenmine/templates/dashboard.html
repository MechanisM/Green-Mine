{% extends "base.html" %}
{% load url from future %}
{% load rawinclude greenmine_utils static cache i18n %}

{% block title %}
<span class="separator"> &gt; </span>
<span class="title-item">{{ project.name|capfirst }}</span>
<span class="separator"> &gt; </span>
<span class="title-item">{% trans "Dashboard" %}</span>
{% endblock %}

{% block wrapper %}
<div id="milestone-dashboard" data-mid="{{ milestone.id }}" class="dashboard" data-api-url="{% url 'dashboard-api' pslug=project.slug %}">
    <div class="top-box">
        <div class="sprint-stats right">
            <div class="stats-box">
                <div class="stats-row">
                    <div class="stats-large left">
                        <progress value="20" max="100"></progress>
                    </div>
                    <div class="stats-large-value left">
                        <span class="value">85%</span>
                        <span class="help-text">{% trans "completed" %}</span>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div class="stats-row">
                    <div class="stats-title left">{% trans "Points" %}</div>
                    <div class="stats-value1 left">
                        <span class="value">120</span>
                        <span class="help-text">{% trans "total points" %}</span>
                    </div>
                    <div class="stats-value2 left">
                        <span class="value">100</span>
                        <span class="help-text">{% trans "assigned points" %}</span>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div class="stats-row">
                    <div class="stats-title left">{% trans "User Stories" %}</div>
                    <div class="stats-value1 left">
                        <span class="value">120</span>
                        <span class="help-text">{% trans "total user stories" %}</span>
                    </div>
                    <div class="stats-value2 left">
                        <span class="value">100</span>
                        <span class="help-text">{% trans "completed user stories" %}</span>
                    </div>
                    <div class="clearfix"></div>
                </div>
                <div class="stats-row">
                    <div class="stats-title left">{% trans "Tasks" %}</div>
                    <div class="stats-value1 left">
                        <span class="value">120</span>
                        <span class="help-text">{% trans "total tasks" %}</span>
                    </div>
                    <div class="stats-value2 left">
                        <span class="value">100</span>
                        <span class="help-text">{% trans "completed tasks" %}</span>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
        <div id="sprint-burndown" data-url="{{ milestone.get_burndown_url }}" show="on" class="sprint-burndown-container">
            <div id="sprint-burndown-graph" style="display:none"></div>
        </div>
    </div>

    <div class="middle-box">
        <div class="middle-header">
            <div class="userstory-description left"></div>
            <div class="userstory-tasks">
                <table>
                    <tr>
                        <th class="status status-new">
                            <div class="status-title-wrapper bg-new">{% trans "New" %}</div>
                        </th>
                        <th class="status status-progress">
                            <div class="status-title-wrapper bg-progress">{% trans "In progress" %}</div>
                        </th>
                        <th class="status status-completed">
                            <div class="status-title-wrapper bg-completed">{% trans "Ready for test" %}</div>
                        </th>
                        <th class="status status-closed">
                            <div class="status-title-wrapper bg-closed">{% trans "Closed" %}</div>
                        </th>
                    </tr>
                </table>
            </div>
            <div class="clearfix"></div>
        </div>

        <div class="middle-body userstory-list">
        </div>
    </div>
</div>


<div class="dashboard-new-task" id="new-task-lightbox">
    <div class="new-task-box">
        <h3>{% trans "New task" %}</h3>

        <section class="newtask-header">
            <h4>{% trans "user story" %}:</h4>
            <section class="userstory-desc">
                Listado de pedidos (wireframe: Perfil Tus pedidos una entrega, Tus pedidos una entrega y este es el resto de la user story. Si es muy larga ponemos puntos suspensivos.
            </section>
        </section>

        <section class="newtask-formset">
            <section class="formset-item">
                <h4>{% trans "Task subject" %}</h4>
                <textarea></textarea>
            </section>
        </section>

        <section class="newtask-meta">
            <div class="button">{% trans "Save" %}</div>
            <span class="cancel"><a href="#">{% trans "Cancelar" %}</a></span>
            <div class="button plus right">+</div>
        </section>
    </div>
</div>

{% endblock %}

{% block top-headers %}
<link type="text/css" media="screen" rel="stylesheet" href="{% static 'css/dashboard.css' %}" />
{% endblock %}

{% block bottom-headers %}
{% raw_include "dot/dashboard-userstory-include.html" %}
{% raw_include "dot/dashboard-userstory-task-include.html" %}

{% to_json user_stories as user_stories_json %}
{% to_json tasks as tasks_json %}
{% to_json statuses as statuses_json %}
{% to_json participants as participants_json %}

<script type="text/javascript" src="{% static "js/bb/dashboard.js" %}"></script>
<script type="text/javascript">
Greenmine.statuses = {{ statuses_json }};
Greenmine.participants = {{ participants_json }};

Greenmine.dashboard = new Greenmine.DashboardView()
Greenmine.burndown = new Greenmine.SprintBurndownView();

Greenmine.usCollection.reset({{ user_stories_json }});
Greenmine.taskCollection.reset({{ tasks_json }});
</script>
{% endblock %}
