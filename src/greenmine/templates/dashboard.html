{% extends "base.html" %}
{% load url from future %}
{% load i18n %}

{% block title %}{{ block.super }} / <a href="{{ project.get_dashboard_url }}">{{ project.name }}{% endblock %}

{% block middle %}
<div id="dashboard-actions">
    <div class="left">
        <div id="bin"></div>
    </div>
    <div class="right">
        <a id="project-admin" class="btn01" href="">{% trans "Project administration" %}</a>

        {% if milestone %}
        <a id="new-us" class="btn01" href="{{ milestone.get_user_story_create_url }}">{% trans "Nueva user story" %}</a>
        {% else %}
        <a id="new-us" class="btn01" href="{{ project.get_user_story_create_url }}">{% trans "Nueva user story" %}</a>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block wrapper %}
<div id="dashboard" rel="{{ project.get_milestones_list_api_url }}">
    <ul id="milestones">
        {# TODO: order_by filter #}
        {% for ml in project.milestones.all %}
        <li class="milestone {% if ml == milestone %}selected{% endif %}">
            <div class="ml">
                <a href="{{ ml.get_dashboard_url }}" class="name">{{ ml.name }}</a>
                {% if ml.estimated_finish %}
                <div><span class="estimated_finish">{{ ml.estimated_finish }}</span></div>
                {% endif %}
            </div>
            <a href="" class="icon0 edit"></a>
            <a class="detail-ml" href="{{ ml.get_ml_detail_url }}"></a>
        </li>
        {% endfor %}

        <li class="milestone {% if not milestone %}selected{% endif %}">
            <div class="ml">
                <a href="{{ project.get_unassigned_dashboard_url }}" class="name">{% trans "Unassigned" %}</a>
            </div>
        </li>
    </ul>

    <div id="tasks-filters">
        <p>
            {{ filtersform.to }}
        </p>
        <p>
            {{ filtersform.state }}
        </p>
        <p>
            {{ filtersform.priority }}
        </p>
    </div>

    <ul id="tasks">
        {% if not milestone %}
            {% for us in project.unasociated_user_stories %}
            <li class="task">
                <div class="dg">{{ us.subject }}
                    <span>[ Estado: {{ us.get_status_display }} | Prioridad: {{ us.get_priority_display }} ]</span>
                </div>
                <a class="edit" href=""></a>
                <a class="detail" href="{{ us.get_view_url }}"></a>
            </li>
            {% empty %}
            <h3>No hay user stories</h3>
            {% endfor %}
        {% else %}
            {% for us in milestone.user_stories.all %}
            <li class="task">
                <div class="dg">{{ us.subject }}
                    <span>[ Estado: {{ us.get_status_display }} | Prioridad: {{ us.get_priority_display }} ]</span>
                </div>
                <a class="edit" href=""></a>
                <a class="detail" href="{{ us.get_view_url }}"></a>
            </li>
            {% empty %}
            <h3>No hay user stories</h3>
            {% endfor %}
        {% endif %}
    </ul>
</div>
{% endblock %}
